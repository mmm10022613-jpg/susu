<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å”ç™¼è¡Œæ³¡èœ | åœ˜è³¼çµ±è¨ˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            padding-bottom: 80px; /* ç‚ºäº†åº•éƒ¨çš„è¨‚è³¼äººæµ®å‹•åˆ—é ç•™ç©ºé–“ */
        }

        /* è‡ªå®šç¾©æ²è»¸ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* è³¼ç‰©è»Šå‹•ç•« */
        .cart-panel {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cart-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* ç”¢å“åœ–ç‰‡æ‡¸åœæ•ˆæœ */
        .product-img-container img {
            transition: transform 0.5s ease;
        }
        .product-card:hover .product-img-container img {
            transform: scale(1.05);
        }

        /* Tab åˆ‡æ›å‹•ç•« */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 antialiased overflow-x-hidden">

    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="fixed top-0 w-full bg-white/90 backdrop-blur-md shadow-sm z-40 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="bg-red-700 text-white p-2 rounded-lg">
                        <span class="font-bold text-xl tracking-widest">å”</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xl font-bold text-gray-900 tracking-wide">å”ç™¼è¡Œæ³¡èœ</span>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-yellow-600 font-medium tracking-wider">åœ˜è³¼çµ±è¨ˆå°å¹«æ‰‹</span>
                            <span class="px-1.5 py-0.5 rounded text-[10px] bg-red-100 text-red-600 font-bold">V2.0</span>
                        </div>
                    </div>
                </div>

                <!-- å³å´æŒ‰éˆ• -->
                <div class="flex items-center gap-4">
                    <button id="cart-toggle" class="relative group p-2 hover:bg-stone-100 rounded-full transition-colors">
                        <i data-lucide="clipboard-list" class="w-6 h-6 text-stone-600 group-hover:text-red-700 transition-colors"></i>
                        <span id="cart-badge" class="absolute top-0 right-0 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-600 rounded-full transform scale-0 transition-transform duration-200">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- è‹±é›„å€å¡Š (Hero) -->
    <header class="relative pt-32 pb-20 lg:pt-48 lg:pb-32 bg-stone-900 overflow-hidden">
        <div class="absolute inset-0 opacity-40">
            <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80" class="w-full h-full object-cover object-center" alt="Background">
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-stone-900 via-stone-900/60 to-transparent"></div>
        
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <span class="inline-block py-1 px-3 rounded-full bg-yellow-500/20 text-yellow-400 text-sm font-semibold mb-6 border border-yellow-500/30 backdrop-blur-sm">
                è¾¦å…¬å®¤åœ˜è³¼ No.1 é¦–é¸
            </span>
            <h1 class="text-4xl sm:text-6xl font-bold text-white mb-6 leading-tight tracking-tight">
                ä¸€å£å…¥é­‚ï¼Œ<span class="text-yellow-400">é»ƒé‡‘æ¯”ä¾‹</span>
            </h1>
            <p class="text-lg sm:text-xl text-stone-300 mb-10 max-w-2xl mx-auto leading-relaxed">
                çµ±è¨ˆè¨‚å–®å¥½å¹«æ‰‹ï¼<br>
                é¸å¥½æ•¸é‡å†åŠ å…¥ï¼Œè¼•é¬†å®Œæˆåœ˜è³¼åˆ†å¸³ã€‚
            </p>
            <div class="flex justify-center gap-4">
                <button onclick="scrollToProducts()" class="px-8 py-4 bg-yellow-500 hover:bg-yellow-400 text-stone-900 font-bold rounded-xl shadow-lg shadow-yellow-500/20 transition-all transform hover:-translate-y-1">
                    é–‹å§‹åœ˜è³¼
                </button>
            </div>
        </div>
    </header>

    <!-- ç”¢å“å€å¡Š -->
    <main id="products" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        
        <!-- åˆ†é¡æ¨™ç±¤ -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-6 md:mb-0 relative">
                äººæ°£ç†±éŠ·ç³»åˆ—
                <span class="absolute -bottom-2 left-0 w-1/2 h-1 bg-yellow-400 rounded-full"></span>
            </h2>
            
            <div class="flex space-x-2 bg-white p-1 rounded-lg shadow-sm border border-stone-200">
                <button class="filter-btn active px-4 py-2 rounded-md text-sm font-medium bg-stone-800 text-white transition-all" onclick="filterProducts('all', this)">å…¨éƒ¨</button>
                <button class="filter-btn px-4 py-2 rounded-md text-sm font-medium text-stone-500 hover:bg-stone-100 transition-all" onclick="filterProducts('spicy', this)">é¦™è¾£ç³»åˆ—</button>
                <button class="filter-btn px-4 py-2 rounded-md text-sm font-medium text-stone-500 hover:bg-stone-100 transition-all" onclick="filterProducts('non-spicy', this)">æ¸…çˆ½ä¸è¾£</button>
            </div>
        </div>

        <!-- ç”¢å“åˆ—è¡¨ç¶²æ ¼ -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- JS ç”Ÿæˆ -->
        </div>
    </main>

    <!-- åº•éƒ¨æ‡¸æµ®ï¼šç›®å‰è¨‚è³¼äººè¨­å®š -->
    <div class="fixed bottom-0 left-0 w-full bg-white border-t border-stone-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-30 px-4 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between sm:justify-center gap-4">
            <div class="flex items-center gap-3 flex-1 sm:flex-none justify-center">
                <div class="flex items-center gap-2 text-stone-600 whitespace-nowrap">
                    <i data-lucide="user-pen" class="w-5 h-5 text-red-600"></i>
                    <span class="font-bold hidden sm:inline">ç›®å‰è¨‚è³¼äºº:</span>
                </div>
                <input type="text" id="current-buyer-input" value="æˆ‘è‡ªå·±" 
                    class="bg-stone-100 border-2 border-transparent focus:border-yellow-500 focus:bg-white rounded-lg px-4 py-2 w-32 sm:w-48 text-center font-bold text-stone-800 outline-none transition-all"
                    onfocus="this.select()">
            </div>
            <button onclick="document.getElementById('cart-toggle').click()" class="sm:hidden relative p-2 bg-stone-100 rounded-full text-stone-600">
                <i data-lucide="clipboard-list" class="w-6 h-6"></i>
                <span id="mobile-badge" class="absolute -top-1 -right-1 w-4 h-4 bg-red-600 rounded-full text-[10px] text-white flex items-center justify-center hidden">0</span>
            </button>
        </div>
    </div>

    <!-- è³¼ç‰©è»Š/åœ˜è³¼çµ±è¨ˆ å´é‚Šæ¬„ -->
    <div id="cart-drawer-overlay" class="cart-overlay fixed inset-0 bg-black/50 z-50 hidden opacity-0" onclick="toggleCart()"></div>
    <div id="cart-drawer" class="cart-panel fixed top-0 right-0 h-full w-full sm:w-[480px] bg-white shadow-2xl z-50 transform translate-x-full flex flex-col">
        
        <!-- æ¨™é ­ -->
        <div class="p-5 border-b border-stone-100 flex justify-between items-center bg-white">
            <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                <i data-lucide="clipboard-check" class="w-5 h-5 text-red-600"></i>
                åœ˜è³¼çµ±è¨ˆè¡¨
            </h2>
            <button onclick="toggleCart()" class="p-2 hover:bg-stone-100 rounded-full transition-colors text-stone-500">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- Tab æŒ‰éˆ• -->
        <div class="flex border-b border-stone-200">
            <button onclick="switchTab('list')" id="tab-btn-list" class="flex-1 py-3 text-sm font-bold text-red-600 border-b-2 border-red-600 bg-red-50 transition-all">
                è¨‚è³¼æ˜ç´°
            </button>
            <button onclick="switchTab('stats')" id="tab-btn-stats" class="flex-1 py-3 text-sm font-bold text-stone-500 hover:text-stone-800 transition-all">
                çµ±è¨ˆ/åˆ†å¸³
            </button>
        </div>

        <!-- å…§å®¹å€åŸŸ -->
        <div class="flex-1 overflow-hidden relative">
            
            <!-- Tab 1: è¨‚è³¼æ˜ç´° (å¯æ“ä½œ) -->
            <div id="tab-content-list" class="tab-content active h-full overflow-y-auto p-5 space-y-4">
                <div id="cart-items-container" class="space-y-4">
                    <!-- JS ç”Ÿæˆ -->
                </div>
            </div>

            <!-- Tab 2: çµ±è¨ˆå ±è¡¨ (å”¯è®€) -->
            <div id="tab-content-stats" class="tab-content h-full overflow-y-auto p-5 bg-stone-50">
                
                <!-- ç¸½é‡çµ±è¨ˆ (çµ¦åº—å®¶) -->
                <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
                    <h3 class="font-bold text-lg text-stone-800 mb-3 flex items-center gap-2">
                        <i data-lucide="package" class="w-5 h-5 text-yellow-500"></i>
                        è¨‚è²¨ç¸½é‡çµ±è¨ˆ
                    </h3>
                    <div id="stats-product-list" class="space-y-2 text-sm">
                        <!-- JS ç”Ÿæˆ -->
                    </div>
                    <div class="mt-4 pt-3 border-t border-stone-100 flex justify-between items-center">
                        <span class="font-bold text-stone-600">ç¸½ç½æ•¸</span>
                        <span class="font-bold text-xl text-red-600" id="stats-total-qty">0</span>
                    </div>
                </div>

                <!-- åˆ†å¸³çµ±è¨ˆ (æ”¶éŒ¢ç”¨) -->
                <div class="bg-white p-4 rounded-xl shadow-sm">
                    <h3 class="font-bold text-lg text-stone-800 mb-3 flex items-center gap-2">
                        <i data-lucide="coins" class="w-5 h-5 text-yellow-500"></i>
                        äººå“¡åˆ†å¸³è¡¨
                    </h3>
                    <div id="stats-user-list" class="space-y-3">
                        <!-- JS ç”Ÿæˆ -->
                    </div>
                </div>

            </div>
        </div>

        <!-- åº•éƒ¨çµç®— -->
        <div id="cart-footer" class="p-6 border-t border-stone-100 bg-white">
            <div class="flex justify-between items-center mb-4">
                <span class="text-stone-600 font-medium">è¨‚å–®ç¸½é‡‘é¡</span>
                <span class="text-2xl font-bold text-red-600" id="cart-total">NT$ 0</span>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="clearCart()" class="w-full py-3 bg-stone-200 hover:bg-stone-300 text-stone-600 font-bold rounded-xl transition-all">
                    æ¸…ç©ºé‡å¡«
                </button>
                <button class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg shadow-red-600/20 transition-all active:scale-95" onclick="submitOrder()">
                    ç¢ºèªé€å‡º
                </button>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-stone-800 text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-3 transition-all duration-300 translate-y-20 opacity-0 z-[60] min-w-[300px] justify-center">
        <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
        <div class="flex flex-col items-start">
            <span id="toast-message" class="text-sm font-bold">å·²åŠ å…¥è³¼ç‰©è»Š</span>
            <span id="toast-sub" class="text-xs text-stone-400">å¹« ç‹å°ç¾ é»äº† é»ƒé‡‘æ³¡èœ</span>
        </div>
    </div>
    
    <!-- Custom Modal å½ˆçª— (å–ä»£ alert/confirm) -->
    <div id="custom-modal-container" class="fixed inset-0 bg-black/50 z-[70] hidden items-center justify-center p-4">
        <div id="custom-modal-content" class="bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all duration-300 scale-90 opacity-0">
            <div class="p-6 max-h-[80vh] overflow-y-auto">
                <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-3"></h3>
                <!-- ä½¿ç”¨ <pre> è®“å ±è¡¨æ–‡å­—æ ¼å¼ä¿æŒåŸæ¨£ -->
                <pre id="modal-message" class="text-sm text-stone-700 whitespace-pre-wrap leading-relaxed bg-stone-50 p-3 rounded-lg border border-stone-100 overflow-x-auto"></pre>
            </div>
            <div id="modal-footer" class="flex justify-end gap-3 p-4 border-t border-stone-100">
                <button id="modal-cancel-btn" class="px-4 py-2 bg-stone-200 hover:bg-stone-300 text-stone-800 font-medium rounded-lg transition-colors hidden">å–æ¶ˆ</button>
                <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // ç”¢å“è³‡æ–™
        const products = [
            { id: 1, name: "é»ƒé‡‘æ³¡èœ", price: 250, tag: "äººæ°£ No.1", category: "non-spicy", image: "https://placehold.co/400x300/FACC15/7F5D00?text=é»ƒé‡‘æ³¡èœ", desc: "é‡‘é»ƒè’œé¦™ï¼Œé…¸ç”œçˆ½è„†" },
            { id: 2, name: "éŸ“å¼æ³¡èœ", price: 220, tag: "è¾›è¾£éç™®", category: "spicy", image: "https://placehold.co/400x300/DC2626/FFFFFF?text=éŸ“å¼æ³¡èœ", desc: "æ­£å®—éŸ“å¼è¾£ç²‰é†ƒè£½" },
            { id: 3, name: "é»ƒé‡‘æµ·å¸¶çµ²", price: 200, tag: "æ¸…çˆ½è§£è†©", category: "non-spicy", image: "https://placehold.co/400x300/10B981/FFFFFF?text=é»ƒé‡‘æµ·å¸¶çµ²", desc: "åš´é¸æ—¥æœ¬æ˜†å¸ƒ" },
            { id: 4, name: "çš®è›‹è¾£æ¤’", price: 280, tag: "ç™½é£¯æ®ºæ‰‹", category: "spicy", image: "https://placehold.co/400x300/333/FFF?text=çš®è›‹è¾£æ¤’", desc: "ç¨å®¶çš®è›‹çµåˆè¾£æ¤’" },
            { id: 5, name: "é»ƒé‡‘æé®‘è‡", price: 240, tag: "Qå½ˆå¤šæ±", category: "non-spicy", image: "https://placehold.co/400x300/EAB308/FFF?text=é»ƒé‡‘æé®‘è‡", desc: "å¤§å¡Šæé®‘è‡å¸é£½æ¹¯æ±" },
            { id: 6, name: "å‚¬æ·šçš®è›‹", price: 260, tag: "é¦™éº»å¸¶å‹", category: "spicy", image: "https://placehold.co/400x300/7f1d1d/FFF?text=å‚¬æ·šçš®è›‹", desc: "æ¤’éº»é¦™æ°£åè¶³" }
        ];

        // è³¼ç‰©è»Šè³‡æ–™çµæ§‹ï¼š { productId, userName, qty, timestamp }
        let cart = [];

        // é¡¯ç¤ºè‡ªå®šç¾©æ¨¡æ…‹è¦–çª— (å–ä»£ alert/confirm)
        function showCustomModal(title, message, isConfirm = false, onConfirm = null) {
            const container = document.getElementById('custom-modal-container');
            const content = document.getElementById('custom-modal-content');
            const titleEl = document.getElementById('modal-title');
            const messageEl = document.getElementById('modal-message');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            // è¨­ç½®å…§å®¹
            titleEl.innerText = title;
            messageEl.innerText = message;
            
            // ç¢ºèª/æç¤ºæ¨¡å¼åˆ‡æ›
            if (isConfirm) {
                cancelBtn.classList.remove('hidden');
                confirmBtn.innerText = 'ç¢ºèªé€å‡º';
                confirmBtn.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors';
            } else {
                cancelBtn.classList.add('hidden');
                confirmBtn.innerText = 'é—œé–‰';
                confirmBtn.className = 'px-4 py-2 bg-stone-800 hover:bg-stone-900 text-white font-medium rounded-lg transition-colors';
            }

            // è¨­ç½®æŒ‰éˆ•äº‹ä»¶
            confirmBtn.onclick = () => {
                hideCustomModal();
                if (isConfirm && onConfirm) {
                    onConfirm();
                }
            };

            cancelBtn.onclick = hideCustomModal;

            // é¡¯ç¤º
            container.classList.remove('hidden');
            container.style.display = 'flex';
            setTimeout(() => {
                content.classList.remove('scale-90', 'opacity-0');
            }, 10);
        }
        
        // éš±è—è‡ªå®šç¾©æ¨¡æ…‹è¦–çª—
        function hideCustomModal() {
            const container = document.getElementById('custom-modal-container');
            const content = document.getElementById('custom-modal-content');
            content.classList.add('scale-90', 'opacity-0');
            setTimeout(() => {
                container.classList.add('hidden');
                container.style.display = 'none';
            }, 300);
        }
        
        // æ¸²æŸ“ç”¢å“
        function renderProducts(filter = 'all') {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            
            const filteredProducts = filter === 'all' ? products : products.filter(p => p.category === filter);

            filteredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border border-stone-100 overflow-hidden flex flex-col group';
                
                // ç”¢ç”Ÿ 1-10 çš„é¸é …
                const options = Array.from({length: 10}, (_, i) => i + 1)
                    .map(num => `<option value="${num}">${num}</option>`).join('');

                card.innerHTML = `
                    <div class="relative overflow-hidden aspect-[4/3] product-img-container">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                        <div class="absolute top-3 left-3 bg-white/90 backdrop-blur text-xs font-bold px-3 py-1 rounded-full shadow-sm text-gray-800">${product.tag}</div>
                    </div>
                    <div class="p-6 flex flex-col flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-gray-900">${product.name}</h3>
                            <span class="text-lg font-bold text-red-600">NT$ ${product.price}</span>
                        </div>
                        <p class="text-sm text-gray-500 mb-4 flex-1 leading-relaxed">${product.desc}</p>
                        
                        <div class="mt-auto">
                            <div class="flex items-center gap-2 mb-3">
                                <label for="qty-${product.id}" class="text-sm font-bold text-stone-600">æ•¸é‡:</label>
                                <select id="qty-${product.id}" class="bg-stone-100 border border-stone-200 text-stone-900 text-sm rounded-lg focus:ring-yellow-500 focus:border-yellow-500 block w-full p-2.5 outline-none font-bold">
                                    ${options}
                                </select>
                            </div>
                            <button onclick="addToCart(${product.id})" class="w-full py-3 bg-stone-800 hover:bg-yellow-500 hover:text-stone-900 text-white font-bold rounded-xl transition-all duration-300 flex items-center justify-center gap-2 shadow-md">
                                <i data-lucide="plus" class="w-4 h-4"></i> åŠ å…¥æ¸…å–®
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // åŠ å…¥è³¼ç‰©è»Š
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const buyerInput = document.getElementById('current-buyer-input');
            const buyerName = buyerInput.value.trim() || "æœªå…·å"; // é è¨­åç¨±
            
            // ç²å–é¸æ“‡çš„æ•¸é‡
            const qtySelect = document.getElementById(`qty-${productId}`);
            const selectedQty = parseInt(qtySelect.value);

            // æª¢æŸ¥è³¼ç‰©è»Šä¸­æ˜¯å¦å·²ç¶“æœ‰ "é€™å€‹äºº" è²· "é€™é …å•†å“"
            const existingItem = cart.find(item => item.productId === productId && item.userName === buyerName);

            if (existingItem) {
                existingItem.qty += selectedQty;
            } else {
                cart.push({
                    productId: product.id,
                    productName: product.name,
                    price: product.price,
                    image: product.image,
                    userName: buyerName,
                    qty: selectedQty,
                    timestamp: Date.now() // ç”¨æ–¼æ’åº
                });
            }
            
            // é‡ç½®æ•¸é‡é¸å–®å› 1
            qtySelect.value = 1;

            updateCartUI();
            updateStatsUI();
            showToast(product.name, buyerName, selectedQty);
            
            if (navigator.vibrate) navigator.vibrate(50);
        }

        // ç§»é™¤/ä¿®æ”¹æ•¸é‡
        function changeQty(productId, userName, delta) {
            const itemIndex = cart.findIndex(item => item.productId === productId && item.userName === userName);
            if (itemIndex > -1) {
                cart[itemIndex].qty += delta;
                if (cart[itemIndex].qty <= 0) {
                    cart.splice(itemIndex, 1);
                }
                updateCartUI();
                updateStatsUI();
            }
        }

        function removeItem(productId, userName) {
            cart = cart.filter(item => !(item.productId === productId && item.userName === userName));
            updateCartUI();
            updateStatsUI();
        }

        function clearCart() {
            // ä½¿ç”¨è‡ªå®šç¾© Modal é€²è¡Œç¢ºèª
            showCustomModal("ç¢ºèªæ¸…ç©º", "æ‚¨ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å·²åŠ å…¥æ¸…å–®çš„å“é …å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚", true, () => {
                cart = [];
                updateCartUI();
                updateStatsUI();
            });
        }
        
        // æäº¤è¨‚å–® (ç”¢ç”Ÿå ±è¡¨ä¸¦æ¸…ç©º)
        function submitOrder() {
            if (cart.length === 0) {
                showCustomModal("æç¤º", "è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼è«‹å…ˆåŠ å…¥å•†å“ã€‚", false);
                return;
            }
            
            // çµ±è¨ˆè³‡æ–™
            const userStats = {};
            let grandTotal = 0;
            
            cart.forEach(item => {
                if (!userStats[item.userName]) {
                    userStats[item.userName] = [];
                }
                userStats[item.userName].push(`${item.productName} x${item.qty}`);
                grandTotal += item.price * item.qty;
            });

            // ç”Ÿæˆå ±è¡¨æ–‡å­—
            let report = "ã€å”ç™¼è¡Œæ³¡èœ - åœ˜è³¼è¨‚å–®çµ±è¨ˆã€‘\n";
            report += "------------------------\n";
            
            for (const user in userStats) {
                report += `ğŸ‘¤ ${user}ï¼š\n`;
                userStats[user].forEach(line => {
                    report += `  - ${line}\n`;
                });
                report += "\n";
            }
            
            report += "------------------------\n";
            report += `ğŸ’° è¨‚å–®ç¸½é‡‘é¡ï¼šNT$ ${grandTotal}\n`;
            report += `ğŸ“¦ ç¸½ç½æ•¸ï¼š${cart.reduce((sum, item) => sum + item.qty, 0)} ç½\n`;
            report += "------------------------\n";
            
            // å½ˆå‡ºç¢ºèªè¦–çª— (ä½¿ç”¨è‡ªå®šç¾© Modal)
            showCustomModal("ç¢ºèªè¨‚å–®ä¸¦é€å‡º", report + "\n\n------------------------\nè«‹ç¢ºèªæ˜ç´°ç„¡èª¤å¾Œï¼Œé€å‡ºå°‡æœƒè‡ªå‹•æ¸…ç©ºè³¼ç‰©è»Šã€‚", true, () => {
                // Confirmed action:
                console.log("åœ˜è³¼å ±è¡¨å·²ç”Ÿæˆ (å¯å¾ Console è¤‡è£½):", report); 
                
                // åŸ·è¡Œé€å‡ºèˆ‡æ¸…ç©ºå‹•ä½œ
                cart = [];
                updateCartUI();
                updateStatsUI();
                toggleCart(); // é—œé–‰å´é‚Šæ¬„
                
                // é¡¯ç¤ºæˆåŠŸæç¤º
                showCustomModal("é€å‡ºæˆåŠŸï¼", "âœ… è¨‚å–®å·²æˆåŠŸé€å‡ºä¸¦æ¸…ç©ºè³¼ç‰©è»Šã€‚\n\næ‚¨å¯è¤‡è£½ä¸Šæ–¹è¨‚å–®æ˜ç´°æ–‡å­—ï¼Œå‚³åˆ°ç¾¤çµ„æˆ– Line çµ¦åœ˜è³¼ä¸»å–”ï¼", false);
            });
        }

        // æ›´æ–° UIï¼šè¨‚è³¼æ˜ç´° Tab
        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            const totalElement = document.getElementById('cart-total');
            const badge = document.getElementById('cart-badge');
            const mobileBadge = document.getElementById('mobile-badge');
            
            // è¨ˆç®—ç¸½é‡èˆ‡é‡‘é¡
            let totalQty = 0;
            let totalPrice = 0;

            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="h-64 flex flex-col items-center justify-center text-stone-400 space-y-4">
                        <i data-lucide="clipboard-list" class="w-16 h-16 opacity-20"></i>
                        <p>ç›®å‰æ²’æœ‰è¨‚å–®</p>
                        <p class="text-xs">è«‹åœ¨ä¸‹æ–¹è¼¸å…¥åå­—å¾Œé–‹å§‹é»é¤</p>
                    </div>`;
            } else {
                // æŒ‰ç…§æœ€è¿‘åŠ å…¥æ’åº
                const sortedCart = [...cart].sort((a, b) => b.timestamp - a.timestamp);
                
                let html = '';
                sortedCart.forEach(item => {
                    const itemTotal = item.price * item.qty;
                    totalQty += item.qty;
                    totalPrice += itemTotal;
                    
                    html += `
                        <div class="flex gap-3 p-3 bg-stone-50 rounded-xl border border-stone-100">
                            <img src="${item.image}" class="w-16 h-16 rounded-lg object-cover bg-white">
                            <div class="flex-1 flex flex-col justify-between">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="bg-stone-800 text-white text-xs px-2 py-0.5 rounded-full font-bold">${item.userName}</span>
                                            <h4 class="font-bold text-gray-900 text-sm line-clamp-1">${item.productName}</h4>
                                        </div>
                                    </div>
                                    <button onclick="removeItem(${item.productId}, '${item.userName}')" class="text-stone-300 hover:text-red-500 p-1">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <div class="flex justify-between items-end">
                                    <span class="text-sm font-bold text-red-600">NT$ ${itemTotal}</span>
                                    <div class="flex items-center bg-white rounded-lg border border-stone-200 h-7 shadow-sm">
                                        <button onclick="changeQty(${item.productId}, '${item.userName}', -1)" class="px-2 h-full hover:bg-stone-100 text-stone-600 rounded-l-lg text-sm">-</button>
                                        <span class="px-2 text-xs font-bold min-w-[1.5rem] text-center">${item.qty}</span>
                                        <button onclick="changeQty(${item.productId}, '${item.userName}', 1)" class="px-2 h-full hover:bg-stone-100 text-stone-600 rounded-r-lg text-sm">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }

            // æ›´æ–°ç¸½é‡‘é¡èˆ‡å¾½ç« 
            totalElement.innerText = `NT$ ${totalPrice}`;
            badge.innerText = totalQty;
            badge.classList.toggle('scale-0', totalQty === 0);
            
            mobileBadge.innerText = totalQty;
            mobileBadge.classList.toggle('hidden', totalQty === 0);

            lucide.createIcons();
        }

        // æ›´æ–° UIï¼šçµ±è¨ˆ Tab
        function updateStatsUI() {
            const productList = document.getElementById('stats-product-list');
            const userList = document.getElementById('stats-user-list');
            const totalQtyEl = document.getElementById('stats-total-qty');

            if (cart.length === 0) {
                productList.innerHTML = '<p class="text-stone-400 text-center py-4">ç„¡è³‡æ–™</p>';
                userList.innerHTML = '<p class="text-stone-400 text-center py-4">ç„¡è³‡æ–™</p>';
                totalQtyEl.innerText = '0';
                return;
            }

            // 1. ä¾ç”¢å“çµ±è¨ˆ
            const productStats = {};
            let grandTotalQty = 0;
            
            cart.forEach(item => {
                if (!productStats[item.productId]) {
                    productStats[item.productId] = { name: item.productName, qty: 0 };
                }
                productStats[item.productId].qty += item.qty;
                grandTotalQty += item.qty;
            });

            let productHtml = '';
            for (const id in productStats) {
                const p = productStats[id];
                productHtml += `
                    <div class="flex justify-between items-center border-b border-stone-100 last:border-0 py-2">
                        <span class="text-stone-700">${p.name}</span>
                        <span class="font-bold bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-md">x ${p.qty}</span>
                    </div>
                `;
            }
            productList.innerHTML = productHtml;
            totalQtyEl.innerText = grandTotalQty;

            // 2. ä¾äººå“¡çµ±è¨ˆ (åˆ†å¸³)
            const userStats = {};
            cart.forEach(item => {
                if (!userStats[item.userName]) {
                    userStats[item.userName] = { total: 0, items: [] };
                }
                userStats[item.userName].total += (item.price * item.qty);
                userStats[item.userName].items.push(`${item.productName} x${item.qty}`);
            });

            let userHtml = '';
            for (const user in userStats) {
                const u = userStats[user];
                userHtml += `
                    <div class="border border-stone-200 rounded-lg p-3 bg-white">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-stone-800 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                ${user}
                            </span>
                            <span class="font-bold text-red-600">NT$ ${u.total}</span>
                        </div>
                        <p class="text-xs text-stone-500 truncate">${u.items.join(', ')}</p>
                    </div>
                `;
            }
            userList.innerHTML = userHtml;
        }

        // Tab åˆ‡æ›é‚è¼¯
        function switchTab(tabName) {
            // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            const btnList = document.getElementById('tab-btn-list');
            const btnStats = document.getElementById('tab-btn-stats');
            
            if (tabName === 'list') {
                btnList.className = 'flex-1 py-3 text-sm font-bold text-red-600 border-b-2 border-red-600 bg-red-50 transition-all';
                btnStats.className = 'flex-1 py-3 text-sm font-bold text-stone-500 hover:text-stone-800 transition-all';
                document.getElementById('tab-content-list').classList.add('active');
                document.getElementById('tab-content-stats').classList.remove('active');
            } else {
                btnStats.className = 'flex-1 py-3 text-sm font-bold text-red-600 border-b-2 border-red-600 bg-red-50 transition-all';
                btnList.className = 'flex-1 py-3 text-sm font-bold text-stone-500 hover:text-stone-800 transition-all';
                document.getElementById('tab-content-stats').classList.add('active');
                document.getElementById('tab-content-list').classList.remove('active');
            }
        }

        // Toast é€šçŸ¥
        function showToast(productName, userName, qty = 1) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = `å·²åŠ å…¥ ${qty} ä»½åˆ°æ¸…å–®`;
            document.getElementById('toast-sub').innerText = `å¹« ${userName} é»äº† ${productName}`;
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // ç¯©é¸ç”¢å“
        function filterProducts(category, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = 'filter-btn px-4 py-2 rounded-md text-sm font-medium text-stone-500 hover:bg-stone-100 transition-all';
            });
            btn.className = 'filter-btn active px-4 py-2 rounded-md text-sm font-medium bg-stone-800 text-white transition-all';
            renderProducts(category);
        }

        // å´é‚Šæ¬„é–‹é—œ
        const cartDrawer = document.getElementById('cart-drawer');
        const overlay = document.getElementById('cart-drawer-overlay');

        function toggleCart() {
            const isClosed = cartDrawer.classList.contains('translate-x-full');
            if (isClosed) {
                cartDrawer.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                document.body.style.overflow = 'hidden';
            } else {
                cartDrawer.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
                document.body.style.overflow = '';
            }
        }
        
        // ç¶å®šè³¼ç‰©è»ŠæŒ‰éˆ•äº‹ä»¶
        document.getElementById('cart-toggle').addEventListener('click', toggleCart);

        // åˆå§‹åŒ–
        renderProducts();

    </script>
</body>
</html>
